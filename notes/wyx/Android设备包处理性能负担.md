## Android设备包处理性能负担
### Linux，Android和XDP的相关实验
#### Linux，XDP，DPDK包处理性能对比
![Linux，XDP，DPDK.png](https://i.loli.net/2019/03/30/5c9f5f11a4362.png)
- 在进行数据包处理的CPU使用率测试时，测试了Linux，XDP和DPDK的情况。

结果显示，在Linux和XDP的对比之中，Linux在负载为5Mpps时CPU使用率就已经达到100%，并且增长可近似为线性。而XDP的实验结果则比较惊喜，在Linux达到100%时，XDP的CPU使用率仅为不到50%，并且在后续的增长放缓，直到达到25Mpps的负载时才几把CPU占满。

同时，比较XDP和DPDK，也可得出XDP的优势。由于DPDK采取轮询方式进行包处理，CPU占用率始终为100%，而在XDP达到CPU使用率100%之前，可以说，XDP的性能情况是优于DPDK的，而25Mpps已经是一个比较优秀的负载水平了。

因而我们可以看到，XDP，尤其是相对于Linux来说，在包处理的性能上，有一个非常巨大的提升。

#### Android数据处理性能测试
对于Android，我们分别简要测试了其在待机状态，4G+LTE状态，和wifi状态下进行数据处理的CPU使用率（处理器为骁龙625）。

- 4G+LTE与待机状态下CPU使用率对比，其中下载11.95Mbps,上传29.21Mbps。
![4G+LTE.png](https://i.loli.net/2019/03/30/5c9f641d96818.png)
经计算，待机状态下CPU的平均使用率为21.27%，而4G+LTE为40.13%，CPU使用率提高了18.86%。

- wifi与待机状态下CPU使用率对比，其中下载23.28Mbps，上传22.38Mbps。
![wifi.png](https://i.loli.net/2019/03/30/5c9f6546c1bfe.png)
经计算，待机状态下CPU的平均使用率为19.81%，而wifi条件下则为35.68%，CPU使用率提高了16.87%。

以上两张图表显示出了一个共同问题，即在数据传输速度为20Mbps左右时，CPU的使用率将会提高20%左右。

#### Android数据转发性能测试

- 在进行数据处理性能测试的同时，我们还进行了数据转发的性能测试。使用在wifi热点转发状态下和待机状态的CPU使用率进行对比，其中下载14.73Mbps，上传14.93Mbps。
![wifi热点转发2.png](https://i.loli.net/2019/03/30/5c9f69664cd9d.png)
经计算，待机状态下CPU的平均使用率为5.82%，而wifi热点转发条件下则为12.56%，CPU使用率提高了6.74%。

进行了数据转发测试后，同样发现其存在CPU使用率大幅增长的情况。

### 实验结果分析

1. 在原生Linux下，CPU的使用率基本呈线性增长，而由于Android是一种基于Linux的自由及开放源代码的操作系统，可以以此类比，在Android上，其CPU使用率也可近似看作随包处理量进行线性增长。由此推论，Android操作系统在达到80Mbps的数据传输速度时，其CPU的使用率将会几近100%。
2. 在Linux和XDP的对比下，我们发现，在同等CPU使用率的条件下，XDP相对于原生Linux有了惊人的提高，在包处理速度上，提高了三倍以上，在高CPU使用率时更为优秀，甚至达到了四倍之多。
同样可以推论，当XDP应用于此前在此方面几乎一片空白的Android，可想而知，其带宽将有巨大的提升空间。
3. 在目前的性能需求来看，由于对大部分用户而言，20Mbps的数据处理速度已经能够满足日常的生活和工作要求（当然对于需求更高的群体而言，在此时的Android环境下同样有相对更高的数据处理速度），因此目前很少看到需求改进的声音。但在5G网络的发展下，其超过100兆/秒的平均数据传输速率，现在的Android的速度和水平已经不足以支撑其需求，势必将要求数据传输速度的提升，而XDP，将是很好的选择。

